<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tool web ƒë·ªÉ t·∫°o v√† serialize JSON cho Unity AdData v·ªõi bidfloor configuration">
    <meta name="keywords" content="Unity, AdData, JSON, Serializer, MAX, Bidfloor">
    <meta name="author" content="AdData Tool">
    <title><%= title %></title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/dynamic.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ AdData JSON Serializer Tool</h1>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">
                Tool ƒë·ªÉ t·∫°o v√† serialize JSON cho AdData class t·ª´ Unity C#<br>
                <strong>C·∫•u tr√∫c m·ªõi: DefaultAdUnitData + BidfloorConfig (Interstitial, Rewarded, Banner)</strong><br>
                <span class="version-badge">Version <%= version %></span>
            </p>
        </header>

        <main>
            <form id="adDataForm" role="form" aria-label="AdData Configuration Form">
            <!-- PROJECT IDENTIFIER GROUP -->
            <section class="group-container" aria-labelledby="project-title">
                <h2 id="project-title" class="group-title">üè∑Ô∏è PROJECT IDENTIFIER</h2>
                <div class="group-description">ƒê·ªãnh danh project v√† qu·∫£n l√Ω d·ªØ li·ªáu</div>

                <!-- Project Management Controls -->
                <div class="section">
                    <h3>üéØ Project Management</h3>
                    <div class="project-controls primary-controls" role="group" aria-label="Primary Project Controls">
                        <button type="button" class="btn btn-success" onclick="createQuickProject()" aria-label="T·∫°o project nhanh v·ªõi script default">‚ö° T·∫°o Project Nhanh</button>
                        <button type="button" class="btn btn-success" onclick="createNewProject()" aria-label="T·∫°o project m·ªõi">‚ûï T·∫°o Project M·ªõi</button>
                        <button type="button" class="btn btn-primary" onclick="showProjectList()" aria-label="Xem danh s√°ch projects">üìÇ Load Project</button>
                        <button type="button" class="btn btn-primary" onclick="saveCurrentProject()" aria-label="L∆∞u project hi·ªán t·∫°i">üíæ L∆∞u Project</button>
                        <button type="button" class="btn btn-success btn-sm" id="autoSaveToggle" onclick="toggleAutoSave()" aria-label="B·∫≠t/t·∫Øt t·ª± ƒë·ªông l∆∞u">üîî Auto-Save: ON</button>
                    </div>
                </div>

                <!-- Current Project Information -->
                <div class="section">
                    <h3>üìã Project Information</h3>
                    <div class="form-group">
                        <label>Project Name:</label>
                        <div class="project-name-container">
                            <div class="project-name-display" id="projectNameDisplay" title="T√™n project hi·ªán t·∫°i">
                                <span id="projectNameText">Ch∆∞a c√≥ project n√†o ƒë∆∞·ª£c ch·ªçn</span>
                            </div>
                            <button type="button" class="btn btn-warning btn-sm rename-btn" onclick="showRenameProjectModal()" id="renameProjectBtn" aria-label="ƒê·ªïi t√™n project hi·ªán t·∫°i" style="display: none;" title="ƒê·ªïi t√™n project">
                                ‚úèÔ∏è ƒê·ªïi t√™n
                            </button>
                        </div>
                        <small style="color: #6c757d; font-style: italic;">S·ª≠ d·ª•ng "Load Project" ƒë·ªÉ ch·ªçn project ho·∫∑c "T·∫°o Project M·ªõi" ƒë·ªÉ t·∫°o m·ªõi</small>
                    </div>

                    <!-- Project Status -->
                    <div id="projectStatus" class="project-status" style="display: none;">
                        <div class="status-info">
                            <span id="projectId" class="project-id"></span>
                            <span id="lastSaved" class="last-saved"></span>
                        </div>
                    </div>
                </div>

                <!-- Script Management Section -->
                <div class="section">
                    <div class="script-management-section">
                        <div class="script-header">
                            <h3>üìú Scripts Management</h3>
                            <div class="script-controls">
                                <select id="currentScriptSelector" onchange="switchScript()">
                                    <option value="">Ch·ªçn script...</option>
                                </select>
                                <button type="button" class="btn btn-success btn-sm" onclick="showAddScriptModal()">‚ûï Th√™m Script</button>
                                <button type="button" class="btn btn-warning btn-sm" onclick="showEditScriptModal()" id="editScriptBtn" disabled>‚úèÔ∏è S·ª≠a Script</button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="deleteCurrentScript()" id="deleteScriptBtn" disabled>üóëÔ∏è X√≥a Script</button>
                            </div>
                        </div>

                        <div class="current-script-info" id="currentScriptInfo" style="display: none;">
                            <div class="script-info-card">
                                <h4 id="currentScriptName">Script Name</h4>
                                <p><strong>Script ID:</strong> <span id="currentScriptId">-</span></p>
                                <p><strong>Tr·∫°ng th√°i:</strong> <span id="currentScriptStatus">Ch∆∞a c√≥ d·ªØ li·ªáu</span></p>
                            </div>
                        </div>

                        <div class="no-script-selected" id="noScriptSelected">
                            <div class="placeholder-message">
                                <div class="placeholder-icon">üìú</div>
                                <h4>Ch∆∞a ch·ªçn script</h4>
                                <p><strong>Vui l√≤ng ch·ªçn script t·ª´ dropdown ·ªü tr√™n ƒë·ªÉ hi·ªÉn th·ªã giao di·ªán c·∫•u h√¨nh d·ªØ li·ªáu.</strong></p>
                                <p>Sau khi ch·ªçn script, b·∫°n s·∫Ω th·∫•y:</p>
                                <ul style="text-align: left; margin: 10px 0;">
                                    <li>üéØ Default Configuration</li>
                                    <li>‚öôÔ∏è Bidfloor Configuration</li>
                                    <li>üìÑ JSON Output</li>
                                </ul>
                                <small>Ho·∫∑c t·∫°o script m·ªõi b·∫±ng n√∫t "‚ûï Th√™m Script"</small>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Project Actions -->
                <div class="section">
                    <h3>‚öôÔ∏è Project Actions</h3>
                    <div class="project-controls action-controls" role="group" aria-label="Project Actions">
                        <button type="button" class="btn btn-info" onclick="exportProject()" aria-label="Xu·∫•t project ra file">üì§ Export Project</button>
                        <button type="button" class="btn btn-info" onclick="importProject()" id="importProjectBtn" aria-label="Nh·∫≠p project t·ª´ file">üì• Import Project</button>
                        <button type="button" class="btn btn-danger" onclick="deleteCurrentProject()" id="deleteProjectBtn" aria-label="X√≥a project hi·ªán t·∫°i" style="display: none;">üóëÔ∏è X√≥a Project</button>
                    </div>

                    <!-- Auto-save Settings -->
                    <div class="auto-save-settings" style="margin-top: 15px;">
                        <details>
                            <summary style="cursor: pointer; color: #6c757d; font-size: 14px;">‚öôÔ∏è C√†i ƒë·∫∑t Auto-Save</summary>
                            <div style="margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <span>Delay:</span>
                                        <select id="autoSaveDelaySelect" onchange="changeAutoSaveDelay()" style="padding: 4px 8px; border-radius: 4px;">
                                            <option value="5000">5 gi√¢y</option>
                                            <option value="8000">8 gi√¢y</option>
                                            <option value="10000">10 gi√¢y</option>
                                            <option value="15000">15 gi√¢y</option>
                                            <option value="30000" selected>30 gi√¢y</option>
                                        </select>
                                    </label>
                                    <small style="color: #6c757d;">Th·ªùi gian ch·ªù tr∆∞·ªõc khi t·ª± ƒë·ªông l∆∞u</small>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </section>

            <!-- DATA CONFIGURATION CONTAINER (Hidden when no script selected) -->
            <div id="dataConfigurationContainer" style="display: none;">

            <!-- DEFAULT GROUP -->
            <div class="group-container">
                <h1 class="group-title">üéØ DEFAULT CONFIGURATION</h1>
                <div class="group-description">C·∫•u h√¨nh m·∫∑c ƒë·ªãnh cho c√°c lo·∫°i qu·∫£ng c√°o</div>

                <!-- DefaultAdUnitData Section -->
                <div class="section ad-unit-section">
                    <div class="section-header">
                        <h2>üì± Default Ad Unit Data</h2>
                        <p class="section-description">C·∫•u h√¨nh ID m·∫∑c ƒë·ªãnh cho c√°c lo·∫°i qu·∫£ng c√°o MAX</p>
                    </div>

                    <div class="ad-unit-grid">
                        <!-- Interstitial -->
                        <div class="ad-unit-card">
                            <div class="ad-unit-header">
                                <div class="ad-unit-icon">üéØ</div>
                                <div class="ad-unit-info">
                                    <h3>Interstitial</h3>
                                    <span class="ad-unit-type">To√†n m√†n h√¨nh</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="interstitialId">Ad Unit ID:</label>
                                <input type="text" id="interstitialId" name="interstitialId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>
                        </div>

                        <!-- Rewarded Video -->
                        <div class="ad-unit-card">
                            <div class="ad-unit-header">
                                <div class="ad-unit-icon">üéÅ</div>
                                <div class="ad-unit-info">
                                    <h3>Rewarded Video</h3>
                                    <span class="ad-unit-type">Video c√≥ th∆∞·ªüng</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="rewardedVideoId">Ad Unit ID:</label>
                                <input type="text" id="rewardedVideoId" name="rewardedVideoId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>
                        </div>

                        <!-- Banner -->
                        <div class="ad-unit-card">
                            <div class="ad-unit-header">
                                <div class="ad-unit-icon">üì∞</div>
                                <div class="ad-unit-info">
                                    <h3>Banner</h3>
                                    <span class="ad-unit-type">Qu·∫£ng c√°o bƒÉng r√¥n</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bannerId">Ad Unit ID:</label>
                                <input type="text" id="bannerId" name="bannerId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>
                        </div>

                        <!-- AOA -->
                        <div class="ad-unit-card">
                            <div class="ad-unit-header">
                                <div class="ad-unit-icon">üöÄ</div>
                                <div class="ad-unit-info">
                                    <h3>AOA (App Open)</h3>
                                    <span class="ad-unit-type">M·ªü ·ª©ng d·ª•ng</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="aoaId">Ad Unit ID:</label>
                                <input type="text" id="aoaId" name="aoaId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="ad-unit-actions">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="clearAllAdIds()">üßπ Clear All</button>
                        <button type="button" class="btn btn-info btn-sm" onclick="generateSampleAdIds()">üé≤ Generate Samples</button>
                        <button type="button" class="btn btn-success btn-sm" onclick="validateAllAdIds()">‚úÖ Validate All</button>
                    </div>
                </div>
            </div>

            <!-- BIDFLOOR GROUP -->
            <div class="group-container bidfloor-section">
                <div class="section-header">
                    <h1 class="group-title">üí∞ BIDFLOOR CONFIGURATION</h1>
                    <div class="group-description">C·∫•u h√¨nh bidfloor cho c√°c lo·∫°i qu·∫£ng c√°o MAX</div>
                </div>

                <!-- Bidfloor Cards Grid -->
                <div class="bidfloor-grid">
                    <!-- Interstitial Bidfloor Card -->
                    <div class="bidfloor-card">
                        <div class="bidfloor-header">
                            <div class="bidfloor-icon interstitial">üéØ</div>
                            <div class="bidfloor-info">
                                <h3>Interstitial Bidfloor</h3>
                                <span class="bidfloor-type">To√†n m√†n h√¨nh</span>
                            </div>
                        </div>

                        <div class="bidfloor-content">
                            <!-- Default ID -->
                            <div class="form-group">
                                <label for="interstitialDefaultId">Default ID:</label>
                                <input type="text" id="interstitialDefaultId" name="interstitialDefaultId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>

                            <!-- Bidfloor IDs -->
                            <div class="form-group">
                                <label>Bidfloor IDs:</label>
                                <div id="interstitialBidfloorIds" class="bidfloor-ids-container">
                                    <div class="array-input">
                                        <div class="array-input-row">
                                            <div class="array-input-field">
                                                <input type="text" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                                            </div>
                                            <button type="button" class="btn btn-add" onclick="addBidfloorId('interstitial', this)">‚ûï</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Settings Grid -->
                            <div class="bidfloor-settings">
                                <div class="settings-row">
                                    <div class="form-group">
                                        <label for="interstitialLoadCount">Load Count:</label>
                                        <input type="number" id="interstitialLoadCount" name="interstitialLoadCount" value="3" min="1" class="number-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="interstitialAutoReloadInterval">Reload Interval:</label>
                                        <input type="number" id="interstitialAutoReloadInterval" name="interstitialAutoReloadInterval" value="99999" min="1" class="number-input">
                                    </div>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="interstitialAutoRetry" name="interstitialAutoRetry">
                                    <label for="interstitialAutoRetry">üîÑ Auto Retry</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rewarded Bidfloor Card -->
                    <div class="bidfloor-card">
                        <div class="bidfloor-header">
                            <div class="bidfloor-icon rewarded">üéÅ</div>
                            <div class="bidfloor-info">
                                <h3>Rewarded Bidfloor</h3>
                                <span class="bidfloor-type">Video c√≥ th∆∞·ªüng</span>
                            </div>
                        </div>

                        <div class="bidfloor-content">
                            <!-- Default ID -->
                            <div class="form-group">
                                <label for="rewardedDefaultId">Default ID:</label>
                                <input type="text" id="rewardedDefaultId" name="rewardedDefaultId" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>

                            <!-- Bidfloor IDs -->
                            <div class="form-group">
                                <label>Bidfloor IDs:</label>
                                <div id="rewardedBidfloorIds" class="bidfloor-ids-container">
                                    <div class="array-input">
                                        <div class="array-input-row">
                                            <div class="array-input-field">
                                                <input type="text" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                                            </div>
                                            <button type="button" class="btn btn-add" onclick="addBidfloorId('rewarded', this)">‚ûï</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Settings Grid -->
                            <div class="bidfloor-settings">
                                <div class="settings-row">
                                    <div class="form-group">
                                        <label for="rewardedLoadCount">Load Count:</label>
                                        <input type="number" id="rewardedLoadCount" name="rewardedLoadCount" value="3" min="1" class="number-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="rewardedAutoReloadInterval">Reload Interval:</label>
                                        <input type="number" id="rewardedAutoReloadInterval" name="rewardedAutoReloadInterval" value="99999" min="1" class="number-input">
                                    </div>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="rewardedAutoRetry" name="rewardedAutoRetry">
                                    <label for="rewardedAutoRetry">üîÑ Auto Retry</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Banner Bidfloor Card -->
                    <div class="bidfloor-card banner-card">
                        <div class="bidfloor-header">
                            <div class="bidfloor-icon banner">üì∞</div>
                            <div class="bidfloor-info">
                                <h3>Banner Bidfloor</h3>
                                <span class="bidfloor-type">Qu·∫£ng c√°o bƒÉng r√¥n</span>
                            </div>
                        </div>

                        <div class="bidfloor-content">
                            <!-- Banner ID -->
                            <div class="form-group">
                                <label for="bidfloorBanner">Banner ID:</label>
                                <input type="text" id="bidfloorBanner" name="bidfloorBanner" placeholder="a1b2c3d4e5f6g7h8" maxlength="16" oninput="validateAdId(this)" onblur="validateAdId(this)" class="ad-id-input">
                                <small class="validation-message validation-info">16 k√Ω t·ª±: a-z, 0-9</small>
                            </div>

                            <!-- Banner Note -->
                            <div class="banner-note">
                                <div class="note-icon">‚ÑπÔ∏è</div>
                                <div class="note-text">
                                    <strong>Banner Configuration</strong><br>
                                    Banner ch·ªâ c·∫ßn m·ªôt ID duy nh·∫•t cho bidfloor
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bidfloor Actions -->
                <div class="bidfloor-actions">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="clearAllBidfloorIds()">üßπ Clear All Bidfloor</button>
                    <button type="button" class="btn btn-info btn-sm" onclick="generateSampleBidfloorIds()">üé≤ Generate Samples</button>
                    <button type="button" class="btn btn-success btn-sm" onclick="validateAllBidfloorIds()">‚úÖ Validate All</button>
                </div>
            </div>
        </form>

        <div class="button-group">
            <button type="button" class="btn btn-primary" onclick="validateEntireForm()">‚úÖ Ki·ªÉm tra d·ªØ li·ªáu</button>
            <button type="button" class="btn btn-primary" onclick="generateJSON()">üîÑ T·∫°o JSON</button>
            <button type="button" class="btn btn-primary" onclick="copyToClipboard()">üìã Copy JSON</button>
            <button type="button" class="btn btn-primary" onclick="downloadJSON()">üíæ T·∫£i xu·ªëng JSON</button>
            <button type="button" class="btn btn-primary" onclick="showImportDataModal()" id="importDataBtn">üì• Import JSON Data</button>
        </div>

        <div class="output-section">
            <h2>üìÑ JSON Output</h2>
            <textarea id="jsonOutput" readonly placeholder="JSON s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y..."></textarea>
        </div>

        </div> <!-- End dataConfigurationContainer -->
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>ƒêang x·ª≠ l√Ω...</p>
        </div>
    </div>

    <!-- Include modals and scripts -->
    <%- include('partials/modals') %>
    
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/validation.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
